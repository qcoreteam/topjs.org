<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>TopJs.js - Documentation</title>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="../css/prettify.css">
    <link type="text/css" rel="stylesheet" href="../css/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="../css/extra.css">
    <link type="text/css" rel="stylesheet" href="../css/common.css">
</head>
<body>
<header class="navbar navbar-fixed-top fixed-header fixed-header-active header hidden-sm-down">
    <nav class="navbar navbar-light">

        <div class="">
            <button class="navbar-toggler hidden-lg-up float-xs-right" type="button" data-toggle="collapse"
                    data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
            <a href="/"><img class="navbar-brand logo" src="../images/logo-green.png"></a>

            <div class="collapse navbar-toggleable-md float-lg-right" id="navbarResponsive">
                <ul class="nav navbar-nav float-lg-right">
                    <li class="nav-item"><a class="nav-link" href="/" >首页</a></li><li class="nav-item"><a class="nav-link" href="/docs/v0.0.1/" >手册</a></li><li class="nav-item"><a class="nav-link" href="/api/" >API文档</a></li><li class="nav-item"><a class="nav-link" href="/categories/blog/" >博客</a></li><li class="nav-item"><a class="nav-link" href="/categories/devel/" >开发日志</a></li><li class="nav-item"><a class="nav-link" href="/about/" >关于我们</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="hidden-md-up sm-header">
    <div class="toggler" id="slideClose"></div>
    <img src="../images/logo-green.png">
</div>
<div class="api-container clearfix">
    <nav>
        <div class="category hidden-md-up">
            <a href="/">首页</a>
            <a href="/docs/v0.0.1/">手册</a>
            <a href="/api/">API文档</a>
            <a href="/categories/blog">博客</a>
            <a href="/categories/devel">开发日志</a>
            <a href="/about">关于我们</a>
        </div>
        <h3>Namespaces</h3><ul class = "entry-type-namespaces"><li><a href="TopJs.html">TopJs</a><ul class='members'><li data-type='member' class='entry-type-class'><a href="TopJs.Array.html">Array</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Assert.html">Assert</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Base.html">Base</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Class.html">Class</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.ClassManager.html">ClassManager</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Config.html">Config</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Date.html">Date</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Error.html">Error</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Function.html">Function</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Loader.html">Loader</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Number.html">Number</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Object.html">Object</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.String.html">String</a></li><li data-type='member' class='entry-type-class'><a href="TopJs.Version.html">Version</a></li></ul></li><li><a href="TopJs.kernel.html">TopJs.kernel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#callParent">callParent</a></li><li><a href="global.html#callSuper">callSuper</a></li><li><a href="global.html#clearPropertiesOnDestroy">clearPropertiesOnDestroy</a></li><li><a href="global.html#destroyed">destroyed</a></li><li><a href="global.html#isConfiguring">isConfiguring</a></li><li><a href="global.html#isFirstInstance">isFirstInstance</a></li><li><a href="global.html#isInstance">isInstance</a></li><li><a href="global.html#statics">statics</a></li></ul>
    </nav>
    <div id="main">
        
        <h1 class="page-title">TopJs.js</h1>
        

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * TopJs Framework (http://www.topjs.org/)
 *
 * @link      http://github.com/qcoreteam/topjs for the canonical source repository
 * @copyright Copyright (c) 2016-2017 QCoreTeam (http://www.qcoreteam.org)
 * @license   http://www.topjs.org/license/new-bsd New BSD License
 */

/**
 * 我们在这个里面定义一些很重要函数，这个函数直接挂载在名称空间TopJs下面
 * 项目的其他地方调用这些函数，这个属于框架初始化部分
 */
import * as InternalFuncs from "./internal/Funcs"
/**
 * @namespace TopJs
 */
export let TopJs = global.TopJs = {};
let emptyFn = function ()
{
};
let privateFn = function ()
{
};
const objProto = Object.prototype;
const toString = objProto.toString;
const iterableRe = /\[object\s*(?:Array|Arguments|\w*Collection|\w*List)\]/;

//设置几个特殊的标记，以便分辨这几类函数
emptyFn.$nullFn$ = emptyFn.$emptyFn$ = privateFn.$privacy$ = true;
emptyFn.$noClearOnDestroy$ = privateFn.$noClearOnDestroy$ = true;

//这个函数主要在实例上实现调用父类覆盖方法
//只要跨过当前一层就ok了
function call_override_parent()
{
    let method = call_override_parent.caller.caller;
    return method.$owner$.prototype[method.$name$].apply(this, arguments);
}

function add_instance_overrides(target, owner, overrides)
{
    for (let [name, value] of Object.entries(overrides)) {
        if (typeof value === "function") {
            //&lt;debug>
            if (owner.$className$) {
                value.name = owner.$className$ + "#" + name;
            }
            //&lt;/debug>
            value.$name$ = name;
            value.$owner$ = owner;
            if (target.hasOwnProperty(name)) {
                value.$previous$ = target[name];//连接已经建立成功了，直接复用
            } else {
                value.$previous$ = call_override_parent;
            }
        }
        target[name] = value;
    }
}

/**
 * 返回当前时间戳
 *
 * @method now
 * @memberof TopJs
 */
TopJs.now = Date.now || function ()
    {
        return +new Date();
    };

/**
 * 返回当前的时间戳，纳秒分辨率
 *
 * @type {Number}
 * @method ticks
 * @memberof TopJs
 */
TopJs.ticks = function ()
{
    let tinfo = process.hrtime();
    return tinfo[0] * 1e9 + tinfo[1]
};

TopJs.$startTime = TopJs.ticks();
/**
 * 有条件的将config的字段复制到object中
 *
 * @memberOf TopJs
 * @param {Object} object 目标的对象
 * @param {Object} config 指定的复制的对象
 * @param {Object} defaults 默认复制对象
 */
TopJs.apply = function (object, config, defaults)
{
    if (defaults) {
        TopJs.apply(object, defaults);
    }
    if (object &amp;&amp; config &amp;&amp; typeof config === "object") {
        for (let key in config) {
            object[key] = config[key];
        }
    }
    return object;
};

/**
 * @namespace TopJs
 */
TopJs.apply(TopJs, /** @lends TopJs */{
    /**
     * ```javascript
     *
     * TopJs.define("MyClass", {
       *    nothing: TopJs.emptyFnm
       *    
       *    privates: {
       *       privateNothing: TopJs.privateFn
       *    }
       * })
     *
     * ```
     *
     * @property {Function} privateFn privateFn
     */
    privateFn: privateFn,

    /**
     * @property {Function} emptyFn 可复用的空函数模板
     */
    emptyFn: emptyFn,

    /**
     * 有条件的将config的字段复制到object中
     *
     * @param {Object} object 目标对象
     * @param {Object} config 指定的复制的对象
     */
    applyIf(object, config)
    {
        if (object) {
            for (let property in config) {
                if (object[property] === undefined) {
                    object[property] = config[property];
                }
            }
        }
        return object;
    },

    /**
     * @method
     * @param {Object} value 等待检查的函数
     * @return {Boolean}
     */
    isArray: ("isArray" in Array) ? Array.isArray :
        function (value)
        {
            return toString.call(value) === "[object Array]";
        },

    /**
     * 判断传入的是否为对象
     *
     * @method
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isObject: InternalFuncs.is_object,

    /**
     * 快速判断传入的对象是否在Object字面类型
     *
     * @private
     * @memberOf TopJs
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isSimpleObject(value)
    {
        return value instanceof Object &amp;&amp; value.constructor === Object;
    },

    /**
     * 判断传入的是否为字符串
     *
     * @method
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isString: InternalFuncs.is_string,

    /**
     * 判断传入的是否为函数
     *
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isFunction(value)
    {
        return !!value &amp;&amp; typeof value === "function";
    },

    /**
     * 如果传入的对象为number返回`true`，不是number或者无穷数返回`false`
     *
     * @param {Object} value 等待测试的值
     * @returns {Boolean}
     */
    isNumber(value)
    {
        return typeof value === "number" &amp;&amp; isFinite(value);
    },

    /**
     * 返回`true`如果传入的对象是`numeric`类型
     *
     * @param {Object} value 例如：1, `1`, `2.34`
     * @return {Boolean}
     */
    isNumeric(value)
    {
        return !isNaN(parseFloat(value)) &amp;&amp; isFinite(value);
    },

    /**
     * 返回`true`如果传入的对象是布尔型
     *
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isBoolean(value)
    {
        return typeof value === "boolean";
    },

    /**
     * 判断传入的对象是否为JavaScript `primitive`，字符串, 数字和布尔类型
     *
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isPrimitive(value)
    {
        let type = typeof value;
        return "string" === type || "number" === type || "boolean" === type;
    },

    /**
     * 判断传入的对象是否为日期类型
     *
     * @param {Object} value 等待检查的对象
     * @return {Boolean}
     */
    isDate(value)
    {
        return toString.call(value) === "[object Date]";
    },

    /**
     * 判断传入的对象是否为空，判断为空的标准是
     * SB
     * - `null`
     * - `undefined`
     * - 空数组
     * - 长度为零的字符串(除非参数`allowEmptyString`为`true`)
     *
     * @param {Object} value 等待测试的值
     * @param {Boolean} allowEmptyString 空字符是否不为空
     * @return {Boolean}
     */
    isEmpty(value, allowEmptyString = false)
    {
        return (value == null) || (!allowEmptyString ? value === "" : false) || TopJs.isArray(value) &amp;&amp; value.length === 0;
    },

    /**
     * 判断传入的对象是否已经定义
     *
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isDefined(value)
    {
        return typeof value !== "undefined";
    },

    /**
     * 探测传入的值是否可遍历
     *
     * @param {Object} value 等待测试的值
     * @return {Boolean}
     */
    isIterable(value)
    {
        if (!value || typeof value.length !== "number" || typeof value === "string" ||
            TopJs.isFunction(value)) {
            return false;
        }
        if (!value.propertyIsEnumerable) {
            return !!value.item;
        }
        if (value.hasOwnProperty("length") &amp;&amp; !value.propertyIsEnumerable("length")) {
            return true;
        }
        return iterableRe.test(toString.call(value));
    },

    /**
     * 确保返回值，如果value不为空返回自己，否则返回defaultValue
     *
     * @param {Object} value
     * @param {Object} defaultValue
     * @param {Object} allowBlank 默认为false，当为true的时候，空字符串不为空
     */
    ensureValue(value, defaultValue, allowBlank = false)
    {
        return TopJs.isEmpty(value, allowBlank) ? defaultValue : value;
    },

    /**
     * 销毁传入的对象，如果传入的是数组，那么递归删除
     *
     * 删除的意思是根据传入的参数决定
     *  * `Array` 所有的元素递归的删除
     *  * `Object` 所有的具有`destroy`方法的都会被调用
     *
     * @param {...Mixed} args 任意数量的对象和数组
     */
    destroy()
    {
        let ln = arguments.length;
        for (let i = 0; i &lt; ln; i++) {
            let arg = arguments[i];
            if (arg) {
                if (TopJs.isArray(arg)) {
                    this.destroy(...arg);
                } else if (Ext.isFunction(arg.destroy)) {
                    arg.destroy();
                }
            }
        }
    },

    /**
     * 删除参数object中指定的字段，在这些字段上调用TopJs.destroy()函数，这些目标删除的字段最终被设置
     * 为`null`。
     *
     * @param {Object} object 将要删除的目标对象
     * @param {...String} args 目标被删除的字段的名称
     * @return {Object}
     */
    destroyMembers(object)
    {
        let len = arguments.length;
        let ref;
        let name;
        for (let i = 1, a = arguments[i]; i &lt; len; i++) {
            name = a[i];
            ref = object[name];
            if (null != ref) {
                TopJs.destroy(ref);
                object[name] = null;
            }
        }
    },

    /**
     * 用给定的值覆盖目标对象的指定的字段
     *
     * 如果目标的`target`的是通过{@link TopJs#define TopJs.define}定义的类，那么
     * 对象的`override`方法将会调用 (参考 {@link TopJs.Base#override}) 把`overrides`
     * 当做参数传入
     *
     * 如果传入的`target`是函数，那么我们默认其为构造函数，`overrides`将使用{@link TopJs.apply}
     * 添加到其的原型对象上
     *
     * 如果目标的`target`的是通过{@link TopJs#define TopJs.define}定义的类的实例化的对象，那么
     * `overrides`将复制到实例对象上，这种情况下，方法拷贝会被特使处理，让其能使用{@link TopJs.Base#callParent}。
     *
     * ```javascript
     * let controller = new TopJs.Controller({ ... });
     *
     * TopJs.override(controller, {
         *    forwardRequest: function()
         *    {
         *       //一些语句
         *       this.callParent();
         *    }
         * });
     *
     * ```
     *
     * 如果`target`不是以上几种，那么`overrides`将使用{@link TopJs#apply}复制到`target`上
     *
     * 详情请参考 {@link TopJs#define}和{@link TopJs.Base#override}
     *
     * @param {Object} target 目标替换对象
     * @param {Object} overrides 替换时使用的值对象
     * @return {Object} 替换之后的对象
     */
    override(target, overrides)
    {
        if (target.$isClass$) {
            target.override(overrides);
        } else if (typeof target === "function") {
            TopJs.apply(target.prototype, overrides);
        } else {
            let owner = target.self;
            let privates;
            if (owner &amp;&amp; owner.$isClass$) {
                // 由 TopJs.define's 类
                privates = overrides.privates;
                if (privates) {
                    overrides = TopJs.apply({}, overrides);
                    delete overrides.privates;
                    add_instance_overrides(target, owner, privates);
                }
                add_instance_overrides(target, owner, overrides);
            } else {
                TopJs.apply(target, overrides);
            }
        }
        return target;
    },

    /**
     * 克隆一个指定的对象
     *
     * @param {Object} item 等待克隆的值
     * @return {Object}
     */
    clone(item)
    {
        if (null === item || undefined === item) {
            return item;
        }
        let type = toString.call(item);
        let clone;
        // Date
        if ("[object Date]" === type) {
            return new Date(item.getTime());
        }

        // Array
        if ("[object Array]" === type) {
            let i = item.length;
            clone = [];
            while (i--) {
                clone[i] = TopJs.clone(item[i]);
            }
        }
        // Object
        else if ("[object Object]" === type &amp;&amp; item.constructor === Object) {
            clone = {};
            for (let key in item) {
                clone[key] = TopJs.clone(item[key]);
            }
        }
        return clone || item;
    },

    /**
     * @private
     */
    Logger: {
        //&lt;feature logger>
        log: function (message, priority)
        {
            if (message &amp;&amp; console) {
                if (!priority || !(priority in console)) {
                    priority = 'log';
                }
                message = '[' + priority.toUpperCase() + '] ' + message;
                console[priority](message);
            }
        },
        verbose: function (message)
        {
            this.log(message, 'verbose');
        },
        info: function (message)
        {
            this.log(message, 'info');
        },
        warn: function (message)
        {
            this.log(message, 'warn');
        },
        error: function (message)
        {
            throw new Error(message);
        },
        deprecate: function (message)
        {
            this.log(message, 'warn');
        }
    } ||
    //&lt;/feature>
    {
        verbose: emptyFn,
        log: emptyFn,
        info: emptyFn,
        warn: emptyFn,
        error: function (message)
        {
            throw new Error(message);
        },
        deprecate: emptyFn
    }
});
/**
 * 这个名称空间是一些`TopJs`框架的底层实现，里面的函数和类定义不遵循`TopJs`的类规范
 * 应用程序不需要直接继承里面的类和函数，直接通过`TopJs`名称空间使用就可以
 *
 * @namespace TopJs.kernel
 */

</code></pre>
        </article>
    </section>




    </div>
</div>



<script src="../js/jquery.min.js"></script>
<script src="../js/tether.min.js" crossorigin="anonymous"></script>

<script src="../js/prettify/prettify.js"></script>
<script src="../js/prettify/lang-css.js"></script>
<script>prettyPrint();</script>

<script src="../js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="../js/linenumber.js"></script>
<script src="../js/maodian.js"></script>

<script src="../js/extra.js"></script>
<script src="../js/common.js"></script>
</body>
</html>
